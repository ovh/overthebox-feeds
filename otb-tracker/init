#!/bin/sh /etc/rc.common

START=90
STOP=10

USE_PROCD=1

TIMEOUT=3
RETRY=2
INTERVAL=3

. /lib/functions/network.sh

_launch_tracker() {
	interface=$1
	tracking=
	config_get_bool tracking "$interface" tracking false
	[ "$tracking" = "1" ] || return 0

	procd_open_instance
	procd_set_param command /bin/otb-tracker -t "$TIMEOUT" -v "$INTERVAL" -r "$RETRY" -i "$interface"
	procd_set_param respawn
	procd_set_param stderr 1
	procd_set_param stdout 1
	procd_close_instance
}

start_service() {
	config_load network
	config_foreach _launch_tracker interface
}

service_triggers() {
	procd_add_reload_trigger network
}

reload_service() {
	stop
	start
}
